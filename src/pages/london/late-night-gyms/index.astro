---
import { PLACES, listAreas } from "../../../data/places";

const url = new URL(Astro.request.url);
const q = (url.searchParams.get("q") ?? "").trim().toLowerCase();
const area = (url.searchParams.get("area") ?? "").trim();
const lateOnly = url.searchParams.get("late") === "1";

const places = PLACES.filter((p) => {
  if (lateOnly && !p.lateNightFriendly) return false;
  if (area && p.area.toLowerCase() !== area.toLowerCase()) return false;
  if (!q) return true;
  const hay = [p.name, p.area, p.nearestTube ?? "", p.hoursNote, p.blurb]
    .join(" ")
    .toLowerCase();
  return hay.includes(q);
});

const areas = listAreas();
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Late-Night Gyms in London</title>
    <meta name="description" content="Late-night gyms in London (verify opening times)." />
    <style>
      body {
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Helvetica, Arial;
        margin: 0;
        color: #111;
      }
      a { color: inherit; }
      .wrap { max-width: 960px; margin: 0 auto; padding: 24px; }
      .card { border: 1px solid #eee; padding: 14px; margin-bottom: 10px; }
    </style>
  </head>
  <body>
    <main class="wrap">
      <h1 style="font-size:28px; margin:0 0 8px;">Late-Night Gyms in London</h1>
      <p style="color:#444; margin:0 0 16px;">Filter by area and late-night friendly flag.</p>

      <form style="display:flex; gap:12px; flex-wrap:wrap; margin-bottom:14px;">
        <input name="q" value={q} placeholder="Search" style="padding:10px; min-width:260px;" />

        <select name="area" style="padding:10px;">
          <option value="" selected={!area}>All areas</option>
          {areas.map((a) => (
            <option value={a} selected={area.toLowerCase() === a.toLowerCase()}>
              {a}
            </option>
          ))}
        </select>

        <label style="display:flex; gap:8px; align-items:center;">
          <input type="checkbox" name="late" value="1" checked={lateOnly} />
          Late-night friendly only
        </label>

        <button type="submit" style="padding:10px 14px; cursor:pointer;">Apply</button>
        <a href="/" style="margin-left:auto; text-decoration:underline;">← Home</a>
      </form>

      <ul style="list-style:none; padding:0; margin:0;">
        {places.map((p) => (
          <li class="card">
            <div style="display:flex; justify-content:space-between; gap:12px;">
              <a href={`/london/late-night-gyms/${p.slug}`}><strong>{p.name}</strong></a>
              <span style="color:#555;">{p.area}</span>
            </div>
            <div style="color:#555; margin-top:6px;">
              {p.nearestTube ? `Near ${p.nearestTube} • ` : ""}{p.hoursNote}
            </div>
          </li>
        ))}
      </ul>

      <p style="margin-top:18px; color:#666; font-size:14px;">
        Gym owner? Want updates? Email <em>hello@yourdomain.com</em>.
      </p>
    </main>
  </body>
</html>
